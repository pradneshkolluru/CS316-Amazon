{% extends "base.html" %}

{% block content %}

<br><br>
{% if current_user.is_authenticated %}
<h2>Your Purchases:</h2>
<form action="{{ url_for('purchases.purchases')}}" method="POST">
  <label for="stringMatch">Product Name: </label>
  <input type="text" id="stringMatch" name="stringMatch" />
<!-- </form>
<form action="{{ url_for('purchases.purchases')}}" method="POST"> -->
  <label for="sellerMatch">Seller Last Name: </label>
  <input type="text" id="sellerMatch" name="sellerMatch" />
<!-- </form>
<form action="{{ url_for('purchases.purchases')}}" method="POST"> -->
  <label for="years">Items purchased in </label>
  <input type="radio" value="" name="years"> All Years </input>
  {% for year in years %}
  <input type="radio" value="{{year}}" name="years"> {{year}} </input>
  {% endfor %}
  <input type="submit"></input>
</form>
<form style="width: auto" action="{{ url_for('purchases.purchases')}}" method="POST">
  <input type="submit" value="Reset Filter" />
</form><br>
{% if query!="" %}
<h5>Current Search: {{query}}</h5>
{%endif%}
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Order ID</th>
      <th scope="col">Product Name</th>
      <th scope="col">Quantity</th>
      <th scope="col">Unit Price</th>
      <th scope="col">Purchase Fulfilled?</th>
      <th scope="col">Order Fulfilled?</th>
      <th scope="col">Date Purchased</th>
      <th scope="col">Seller Name</th>
      <th scope="col">Buy Again</th>
    </tr>
  </thead>
  <tbody>
    {% for item in all_purchases%}
      <tr>
        <th scope="row">
          <a href="{{ url_for('order.get_order', oid=item.oid) }}"> {{item.oid}} </a>
        </th> 
        <td>{{item.product_name}}</td>
        <td>{{item.qty}}</td>
        <td>{{item.unit_price}}</td>

        {% if item.purchase_fulfilled %}
        <td style="color:#23A129; text-align:center">&#x2713;</td>
        {% else %}
        <td style="color:#FF0000; text-align:center">&#10007;</td>
        {% endif %}

        {% if item.order_fulfilled %}
        <td style="color:#23A129; text-align:center">&#x2713; </td>
        {% else %}
        <td style="color:#FF0000; text-align:center">&#10007;</td>
        {% endif %}

        <td>{{item.time_purchased}}</td>
        <td>{{item.sellerfirst}} {{item.sellerlast}}</td>
        <td>
          <form
          action="{{ url_for('cart.add_to_cart', product_id=item.pid) }}"
          method="POST"
        >
          <input type="submit" value="Add to Cart" />
        </form>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your orders!</p>
{% endif %}

{% endblock %}
