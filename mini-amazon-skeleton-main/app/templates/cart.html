{% extends "base.html" %} {% block content %}
<head>
  <style>
    .changeQuantity {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 5px;
    }
  </style>
</head>
<br /><br />
{% if current_user.is_authenticated %}
<h2>Your Cart:</h2>
<h4>Your current balance is: ${{current_user.balance}}. Add more
  <a href="{{ url_for('users.show_info') }}"> here.</a>
</h4>


<p>
  {% with messages = get_flashed_messages() %}
  {% if messages %}
  <ul>
    {% for message in messages %}
    <span style="color: red;">{{ message }}</span>
    {% endfor %}
  </ul>
  {% endif %}
  {% endwith %}
</p>
<table class="table table-hover table-bordered container">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Product Name</th>
      <th scope="col">Quantity</th>
      <th scope="col">Unit Price</th>
      <th scope="col">Delete from Cart</th>
      <th scope="col">Save for Later</th>
    </tr>
  </thead>
  <tbody>
    {% for item in cart_products%}
    <tr>
      <!-- <td>{{ loop.index + pagination.skip }}</td> -->
      <td><a href="{{ url_for('products.product_info', id=item.pid) }}">{{item.product_name}}</a></td>
      <!-- product name -->
      <td class="changeQuantity">
        <!-- quantity -->
        <form action="{{ url_for('cart.change_item_qty') }}" method="POST">
          <input name="pid" value="{{item.pid}}" hidden="true" />
          <input name="qty" value="-1" hidden="true" />
          <input type="submit" value="-" />
        </form>
        {{item.qty}}
        <form action="{{ url_for('cart.change_item_qty') }}" method="POST">
          <input name="pid" value="{{item.pid}}" hidden="true" />
          <input name="qty" value="1" hidden="true" />
          <input type="submit" value="+" />
        </form>
      </td>
      <td>${{item.unit_price}}</td>
      <!-- unit price -->
      <td>
        <!-- delete from cart -->
        <form
          action="{{ url_for('cart.delete_from_cart', product_id=item.pid) }}"
          method="POST"
        >
          <input type="submit" value="Delete from Cart" />
        </form>
      </td>
      <td>
        <!-- save for later -->
        <form
          action="{{ url_for('saveForLater.save_for_later', product_id=item.pid) }}"
          method="POST"
        >
          <input type="submit" value="Save for Later" />
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<p>Total Price: ${{total_cart_price}}</p>
{% if num_line_items > 0 %}
<form
  action="{{ url_for('cart.try_submit_order') }}"
  method="POST"
>
  <input type="submit" value="Submit Order" />
</form>
{% endif %}

{{ pagination.links }} 

<br><br>

<h2>Saved For Later:</h2>

<!-- Saved For Later table -->
<table class="table table-hover table-bordered container">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Product Name</th>
      <th scope="col">Unit Price</th>
      <th scope="col">Add to Cart?</th>
      <th scope="col">Delete</th>
    </tr>
  </thead>
  <tbody>
    {% for item in saved_items %}
    <tr>
      <td><a href="{{ url_for('products.product_info', id=item.pid) }}">{{item.product_name}}</a></td>
      <!-- product name -->
      <td>${{item.unit_price}}</td>
      <!-- unit price -->
      <td>
        <!-- add back to cart -->
        <form
          action="{{ url_for('saveForLater.add_saved_to_cart', product_id=item.pid) }}"
          method="POST"
        >
          <input type="submit" value="Add to Cart" />
        </form>
      </td>
      <td>
        <!-- delete from saved -->
        <form
          action="{{ url_for('saveForLater.delete_from_saved', product_id=item.pid) }}"
          method="POST"
        >
          <input type="submit" value="Delete" />
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your cart!</p>
{% endif %} {% endblock %}
